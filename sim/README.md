# simulator amatsukaze

## 使用方法

```
make
./amatsukaze code [options]
```

### 出力
* 各種データを標準エラー出力に出力
  * エラー出力の内容
    * 実行終了時に、各種レジスタの値を出力
    * 実行終了時に、それぞれの命令が発行された回数を出力

### 終了条件
* PCが最後の命令の次の番地に到達すると終了とみなす
* もしくは、自分自身へのbr命令(`br $a, 0`)を実行すると終了する

### その他
* 命令は0番地から順に置かれる
* FPUはとりあえず全てネイティブ

## テストケース
* 機械語のファイルの後に、期待されるレジスタの値を記したファイルを指定する
  * 指定されなかった場合や全て一致した場合は終了ステータス0を返す
  * 不一致のレジスタが存在した場合はその旨を出力して終了ステータス1を返す

### フォーマット

```
$a xxxxxxxx
$fa xxxxxxxx
```

* レジスタの名前と、期待される値(符号なし十六進数)を1行に1つ指定する
* 順番は任意
* 指定しないレジスタがあっても良い

## オプション
* `-d`
  * 命令実行ごとに、現在のPCと実行中の命令を出力
* `-r`
  * 命令実行ごとに、(`-d`オプションに加え)全てのレジスタの値を出力
* `-m`
  * ロード命令時に、アドレスと読み込んだ値を出力
  * ストア命令時に、アドレスと書き込む前後の値を出力
* `-n <insts>`
  * 浮動小数点演算において、ネイティブの演算を使用する
    * 指定しなかった場合、(実装されているものについては)ソフトウェア実装が使われる
    * instsに命令の名前を指定すると、その命令についてのみネイティブ演算が使用される
      * `-n adds sqrts` など
    * `insts`を指定しない場合、全ての演算にネイティブ演算が使用される
* `-l <n>`
  * 最大n命令で実行を終了する
    * nは十進数
* `-s <logfile>`
  * `bsr`命令のジャンプ先の統計を取り、`<logfile>`に出力する
  * `asm/stat <assembly> <logfile>`でラベルと対応付けることができる
  * 出力ファイル名を省略した場合は`機械語ファイル名.log`に出力
* `-cache x y`
  * tagがxビット、lineがyビット、すなわち 2^y words 2^x lines の
  ダイレクトマップキャッシュを使用する
  * デフォルトは`-cache 7 3`
* `-cache2 x y`
  * tagがxビット、lineがyビット、すなわち 2^y words (2^x * 2) lines の
  2wayセットアソシアティブキャッシュを使用する
